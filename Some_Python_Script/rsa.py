# 分解模数n
def rsa_moder(n):
    base = 2
    while base < n:
        if n % base == 0:
            return base, n // base
        base += 1


# 求欧拉函数f(n)
def rsa_get_euler(prime1, prime2):
    return (prime1 - 1) * (prime2 - 1)


# 求私钥
def rsa_get_key(e, euler):
    k = 1
    while True:
        if (((euler * k) + 1) % e) == 0:
            return (euler * k + 1) // e
        k += 1


# 根据n,e计算d(或根据n,d计算e)
def get_rsa_e_d(n, e=None, d=None):
    if e is None and d is None:
        return

    arg = e
    if arg is None:
        arg = d

    primes = rsa_moder(n)
    p = primes[0]
    q = primes[1]

    d = rsa_get_key(arg, rsa_get_euler(p, q))

    return d


def test():
    str_fmt = 'n: {:<10} e: {:<10} d: {:<10}'

    # 导入rsa库
    import rsa as rsa
    key = rsa.newkeys(24)

    # 产生rsa密钥对
    if isinstance(key[1], rsa.PrivateKey):
        print(str_fmt.format(key[1].n, key[1].e, key[1].d))

    # 解密
    n = 14666299
    d = 2101153
    e = get_rsa_e_d(n, None, d)
    print(str_fmt.format(n, e, d))

    n = 12748507
    e = 65537
    d = get_rsa_e_d(n, e, None)
    print(str_fmt.format(n, e, d))

    n=36674481750646745584377378613216648029318064173992844184622499435591117799403051872371909701784700299464339187157916160860106265717350947340265764801829296397430378530940008237443099111544924950307801944924739346609688265394820205343460391556294490281915274171918110623320455091651740836887276065783802644141836664947210946620893046200346919016927057454084705807703312055197332787535255024765959089064847182111510846595092957646459391871307092931318416190048132874170435358035862556937699167902385327579592886301761862878788819966301985930572828398517445509900905755537177110658050191148927476276856701426428027793701
    e=31337
    d = get_rsa_e_d(n, e, None)
    print(str_fmt.format(n, e, d))

    n=41547510450310971134643847375897443467639487855486897174677786407417282980827904083564171574743879560010239186763369973581540347051619745780356556193158448680466680921374310926376395309497425557284932490082044908359792426361000622284150000384559057351282785701594525183934525134401938139334624002214110256505582206194768417598906985953444293304397719145759535776407550603700784141186619127849932531361329865824877821696114711632504113266547712649088058383571534850811556249464117943059471127140416298293546683168035923164173089473059263256529061432116560925502592040863681860703780651696865183401806944523711671321225
    e=31337
    d = get_rsa_e_d(n, e, None)
    print(str_fmt.format(n, e, d))
if __name__ == '__main__':
    test()